{% extends 'base.html' %}

{% load static  %}

{% block content %}
      <!-- Side-Nav-->
      <aside class="main-sidebar hidden-print ">
         <section class="sidebar" id="sidebar-scroll">
            <!-- Sidebar Menu-->
            <ul class="sidebar-menu">
               <li class="treeview">
                  <a class="waves-effect waves-dark" href="{% url 'home' %}">
                     <i class="icon-speedometer"></i><span> Dashboard</span>
                  </a>                
               </li>
                
               <li class="active treeview"><a class="waves-effect waves-dark" href="#!"><i class="icon-book-open"></i><span> Customer Reports</span><i class="icon-arrow-down"></i></a>
                  <ul class="treeview-menu">
                     <li><a class="waves-effect waves-dark" href="{% url 'customerform' %}"><i class="icon-arrow-right"></i> Customer Register</a></li>
                     
                     <li><a class="waves-effect waves-dark" href="{% url 'customer_table' %}"><i class="icon-arrow-right"></i>  Customer Data</a></li>

                     {% comment %} <li><a class="waves-effect waves-dark" href="{% url 'user_data' %}"><i class="icon-arrow-right"></i>  Register Data</a></li> {% endcomment %}
                  </ul>
               </li>

               <li class=" treeview"><a class="waves-effect waves-dark" href="#!"><i class="icon-book-open"></i><span> Customer Reports</span><i class="icon-arrow-down"></i></a>
                  <ul class="treeview-menu">
                     <li><a class="waves-effect waves-dark" href="{% url 'customerform' %}"><i class="icon-arrow-right"></i> Customer Register</a></li>
                     
                     <li><a class="waves-effect waves-dark" href="{% url 'customer_table' %}"><i class="icon-arrow-right"></i>  Customer Data</a></li>

                     <li><a class="waves-effect waves-dark" href="{% url 'user_data' %}"><i class="icon-arrow-right"></i>  Register Data</a></li>

                  </ul>
               </li>

               <li class=" treeview"><a class="waves-effect waves-dark" href="#!"><i class="icon-book-open"></i><span> Categories</span><i class="icon-arrow-down"></i></a>
                  <ul class="treeview-menu">
                     <li><a class="waves-effect waves-dark" href="{% url 'category_register' %}"><i class="icon-arrow-right"></i> Category Register</a></li>
                     
                     <li><a class="waves-effect waves-dark" href="{% url 'category_show' %}"><i class="icon-arrow-right"></i>  Categories Data</a></li>
      
                  </ul>
               </li>

               <li class="treeview">
                  <a class="waves-effect waves-dark" href="{% url 'customer_table_data_json' %}">
                     <i class="icon-speedometer"></i><span> JSON Data</span>
                  </a>                
               </li>

               <li class="treeview">
                  <a class="waves-effect waves-dark" href="{% url 'socical_media' %}">
                     <i class="icon-speedometer"></i><span> Social Media </span>
                  </a>                
               </li>
                
               
            </ul>
         </section>
      </aside>
      
      <div class="content-wrapper">
         <!-- Container-fluid starts -->
         <div class="container-fluid">

            <!-- Header Starts -->
            <div class="row">
               <div class="col-sm-12 p-0">
                  <div class="main-header">
                     <h4>Customer Data</h4>
                     
                  </div>
               </div>
            </div>
            <!-- Header end -->

            <!-- Tables start -->
            <!-- Row start -->
            <!-- Hover effect table starts -->
            <div class="card">
               <div class="card-block">
                  <div class="row">
                     <div class="col-12 table-responsive">
                        <table id="datatableprogrammers" class="table">
                           <thead>
                              <tr>
                                   <th>ID</th>
                                   <th>First Name</th>
                                   <th>Last Name</th>
                                   <th>Email</th>
                                   <th>Phone</th>
                                   <th>City</th>
                              </tr>
                           </thead>
                           <tbody id="data_table">
                           </tbody>
                       </table>
                     </div>
                  </div>
               </div>
            </div>
            
            <a href="{% url 'customerform' %}"> <button type="submit" class="btn btn-primary waves-effect waves-light m-r-30">Add Customer Form</button> </a>
            <!-- Hover effect table ends -->
            <!-- Row end -->
            <!-- Tables end -->
         </div>
      </div>
   </div>
   <script>
      let dataTable;
      let dataTableIsInitialized = false;

      const initDataTable = async () => {
         if (dataTableIsInitialized) {
            dataTable.destroy();
         }

         await listProgrammers();

         dataTable = $("#datatableprogrammers").DataTable({});

         dataTableIsInitialized = true;
      };

      const listProgrammers = async () => {
         try {
            const response = await fetch("http://127.0.0.1:8000/app/customer_table_data/");
            const data = await response.json();

            let content = '';
            data.programdata.forEach(data => {
               content += `
                  <tr>
                     <td>${data.id}</td>
                     <td>${data.first_name}</td>
                     <td>${data.last_name}</td>
                     <td>${data.email}</td>
                     <td>${data.phone}</td>
                     <td>${data.city}</td>
                  </tr>
               `;
            });
            data_table.innerHTML = content;
         } catch (ex) {
            alert(ex);
         }
      };

      window.addEventListener('load', async () => {
         await initDataTable();
      });
   </script>
{% endblock %}

